<!DOCTYPE html>
<html manifest="cache.manifest">
<head>
    <meta charset="UTF-8">
    <title>iPad 3 Notes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">

    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, Helvetica, Arial, sans-serif;
            background-color: #f2f2f7;
            margin: 0; padding: 0;
            height: 100vh; overflow: hidden;
        }

        /* Barra de Status do Cache (NOVO) */
        #cache-status {
            background: #ffcc00; /* Amarelo = Carregando */
            color: #000;
            text-align: center;
            padding: 10px;
            font-size: 14px;
            font-weight: bold;
            position: absolute;
            top: 0; left: 0; right: 0;
            z-index: 9999;
        }

        .header {
            background-color: #f8f8f8;
            border-bottom: 1px solid #c7c7cc;
            height: 64px;
            /* Ajuste para não ficar embaixo da status bar se estiver no modo app */
            padding-top: 20px; 
            display: flex; align-items: center; justify-content: center;
            position: relative;
            margin-top: 0px; 
        }

        .header h1 { font-size: 17px; font-weight: 600; margin: 0; color: #000; }
        
        .add-btn {
            position: absolute; right: 15px; top: 30px;
            color: #007aff; font-size: 24px; line-height: 1;
            cursor: pointer; border: none; background: none;
        }

        #list-container {
            height: calc(100% - 64px);
            overflow-y: auto; -webkit-overflow-scrolling: touch;
            padding-top: 0; /* Removido padding extra */
        }

        .task-item {
            background: #fff; padding: 15px;
            border-bottom: 1px solid #e5e5ea;
            display: flex; align-items: center; justify-content: space-between;
            font-size: 17px;
        }

        .delete-btn {
            background: #ff3b30; color: white; border: none;
            padding: 5px 12px; border-radius: 4px; font-size: 14px;
        }

        /* Modal Styles */
        #modal {
            display: none; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%; background: rgba(0,0,0,0.4);
            z-index: 100; justify-content: center; align-items: center;
        }
        .modal-content {
            background: rgba(255, 255, 255, 0.95); width: 300px;
            border-radius: 12px; text-align: center; padding: 20px;
        }
        #task-input {
            width: 100%; padding: 8px; border: 1px solid #ccc;
            border-radius: 5px; font-size: 16px; margin-bottom: 15px;
        }
        .modal-actions { display: flex; border-top: 1px solid #ccc; margin: 0 -20px -20px -20px; }
        .modal-btn { flex: 1; padding: 15px; border: none; background: transparent; font-size: 17px; }
        .cancel { color: #007aff; border-right: 1px solid #ccc; }
        .save { color: #007aff; font-weight: 600; }
    </style>
</head>
<body>

    <!-- Aviso de Status do Cache -->
    <div id="cache-status">Verificando Instalação...</div>

    <div class="header">
        <h1>Minhas Notas</h1>
        <button class="add-btn" onclick="openModal()">+</button>
    </div>

    <div id="list-container"></div>

    <div id="modal">
        <div class="modal-content">
            <span style="font-weight:600; display:block; margin-bottom:15px">Nova Nota</span>
            <input type="text" id="task-input" placeholder="O que fazer?">
            <div class="modal-actions">
                <button class="modal-btn cancel" onclick="closeModal()">Cancelar</button>
                <button class="modal-btn save" onclick="addTask()">OK</button>
            </div>
        </div>
    </div>

    <script>
        // --- LÓGICA DO CACHE (DIAGNÓSTICO) ---
        var statusDiv = document.getElementById('cache-status');
        var appCache = window.applicationCache;

        function updateStatus(msg, color) {
            statusDiv.innerHTML = msg;
            statusDiv.style.background = color;
            if (color === '#4cd964') { // Verde
                statusDiv.style.color = '#fff';
                // Esconder após 5 segundos se for sucesso
                setTimeout(function(){ statusDiv.style.display = 'none'; }, 5000);
            } else if (color === '#ff3b30') { // Vermelho
                statusDiv.style.color = '#fff';
            }
        }

        // Eventos do AppCache
        appCache.addEventListener('checking', function() { updateStatus('Buscando atualizações...', '#ffcc00'); }, false);
        appCache.addEventListener('downloading', function() { updateStatus('Baixando App para uso Offline...', '#ffcc00'); }, false);
        appCache.addEventListener('progress', function(e) { updateStatus('Baixando arquivos...', '#ffcc00'); }, false);
        
        appCache.addEventListener('cached', function() { 
            updateStatus('PRONTO! Adicione à Tela de Início agora.', '#4cd964'); // Verde
        }, false);
        
        appCache.addEventListener('updateready', function() { 
            appCache.swapCache();
            updateStatus('Atualizado! Recarregue a página.', '#4cd964'); 
        }, false);
        
        appCache.addEventListener('noupdate', function() { 
            updateStatus('App Offline Ativo.', '#4cd964'); // Verde
        }, false);
        
        appCache.addEventListener('error', function(e) { 
            updateStatus('ERRO no Cache. Verifique o arquivo manifest.', '#ff3b30'); // Vermelho
        }, false);

        // Se estiver rodando como App (tela cheia), esconder a barra
        if (window.navigator.standalone) {
            statusDiv.style.display = 'none';
        }

        // --- LÓGICA DO APP (NOTAS) ---
        var tasks = JSON.parse(localStorage.getItem('ios9tasks')) || [];
        
        function renderTasks() {
            var container = document.getElementById('list-container');
            container.innerHTML = '';
            if (tasks.length === 0) {
                container.innerHTML = '<div class="task-item" style="text-align:center; color:#8e8e93; display:block; border:none;">Nenhuma nota ainda</div>';
                return;
            }
            for (var i = 0; i < tasks.length; i++) {
                var div = document.createElement('div');
                div.className = 'task-item';
                var span = document.createElement('span');
                span.innerText = tasks[i];
                var btn = document.createElement('button');
                btn.className = 'delete-btn';
                btn.innerText = 'Apagar';
                (function(index) { btn.onclick = function() { deleteTask(index); }; })(i);
                div.appendChild(span); div.appendChild(btn); container.appendChild(div);
            }
        }

        function addTask() {
            var input = document.getElementById('task-input');
            if (input.value) {
                tasks.push(input.value);
                localStorage.setItem('ios9tasks', JSON.stringify(tasks));
                renderTasks(); closeModal(); input.value = '';
            }
        }
        function deleteTask(index) {
            tasks.splice(index, 1);
            localStorage.setItem('ios9tasks', JSON.stringify(tasks));
            renderTasks();
        }
        function openModal() { document.getElementById('modal').style.display = 'flex'; setTimeout(function(){ document.getElementById('task-input').focus();},100);}
        function closeModal() { document.getElementById('modal').style.display = 'none'; }
        
        renderTasks();
        document.body.addEventListener('touchmove', function(e) { if (!e.target.closest('#list-container')) e.preventDefault(); }, false);
    </script>
</body>
</html>